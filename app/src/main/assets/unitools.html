<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Toolkit</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        /* === FINAL, POLISHED CSS STYLING === */
        :root {
            --color-bg-main: #f0f2f5;
            --color-bg-card: #ffffff;
            --color-primary-accent: #007BFF;
            --color-text-primary: #212529;
            --color-text-secondary: #6c757d;
            --color-border: #dee2e6;
            --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            --border-radius: 16px;
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.05);
            --shadow-md: 0 5px 15px rgba(0,0,0,0.1);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: var(--font-family); background-color: var(--color-bg-main); color: var(--color-text-primary); line-height: 1.6; }
        .main-content { padding: 1.5rem; }
        .tools-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 1rem; }
        .tool-card { background-color: var(--color-bg-card); border-radius: var(--border-radius); padding: 1rem; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: transform 0.2s ease, box-shadow 0.2s ease; box-shadow: var(--shadow-sm); cursor: pointer; text-align: center; aspect-ratio: 1 / 1; }
        .tool-card:hover { transform: translateY(-5px); box-shadow: var(--shadow-md); }
        .tool-card .card-icon { font-size: 2.25rem; color: var(--color-primary-accent); margin-bottom: 0.75rem; }
        .tool-card h2 {
            /* MODIFIED: Decreased font size for a cleaner look */
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--color-text-primary);
        }
        .btn { display: inline-block; background-color: var(--color-primary-accent); color: #fff; border: none; border-radius: 8px; padding: 10px 20px; font-weight: 600; cursor: pointer; text-align: center; transition: background-color 0.2s ease; }
        .btn:hover { background-color: #0056b3; }
        .btn-secondary { background-color: var(--color-text-secondary); }
        .btn-secondary:hover { background-color: #5a6268; }
        .tool-input, .tool-select, .tool-textarea { width: 100%; padding: 10px; background-color: #fff; border: 1px solid var(--color-border); border-radius: 8px; color: var(--color-text-primary); font-size: 1rem; margin-bottom: 1rem; }
        .tool-input:focus, .tool-select:focus, .tool-textarea:focus { outline: none; border-color: var(--color-primary-accent); box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25); }
        .tool-textarea { min-height: 120px; resize: vertical; }
        .modal-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.4); backdrop-filter: blur(4px); display: flex; justify-content: center; align-items: center; z-index: 2000; opacity: 0; visibility: hidden; transition: opacity 0.3s ease; }
        .modal-container.show { opacity: 1; visibility: visible; }
        .modal-content { background-color: var(--color-bg-main); padding: 1.5rem; border-radius: var(--border-radius); box-shadow: var(--shadow-md); width: 90%; max-width: 600px; max-height: 90vh; overflow-y: auto; position: relative; transform: translateY(20px); transition: transform 0.3s ease; }
        .modal-container.show .modal-content { transform: translateY(0); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid var(--color-border); }
        .modal-header h2 { font-size: 1.5rem; color: var(--color-text-primary); }
        .modal-description { font-size: 1rem; color: var(--color-text-secondary); margin-bottom: 1.5rem; }
        .modal-close-btn { background: none; border: none; font-size: 1.75rem; cursor: pointer; color: var(--color-text-secondary); }
        .modal-close-btn:hover { color: var(--color-text-primary); }
        .notification { position: fixed; bottom: -100px; left: 50%; transform: translateX(-50%); background-color: #333; color: white; padding: 12px 24px; border-radius: 8px; box-shadow: var(--shadow-md); z-index: 3000; transition: bottom 0.5s ease, opacity 0.5s ease; }
        @media (max-width: 600px) { .tools-grid { grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); } }
    </style>
</head>
<body>
    <main class="main-content">
        <section id="tools">
            <div class="tools-grid"></div>
        </section>
    </main>

    <div id="modal-container" class="modal-container">
        <div id="modal-content" class="modal-content"></div>
    </div>

    <div id="notification" class="notification"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const toolsGrid = document.querySelector('.tools-grid');
            const modalContainer = document.getElementById('modal-container');
            const modalContent = document.getElementById('modal-content');
            const notificationEl = document.getElementById('notification');

            // =================================================================
            // FINAL, WORKING DOWNLOAD FUNCTION
            // =================================================================
            function downloadFile(data, fileName, fileType) {
                if (typeof Android !== 'undefined' && Android.saveBase64File) {
                    const reader = new FileReader();
                    reader.onload = function() {
                        const base64Data = reader.result.split(',')[1];
                        Android.saveBase64File(base64Data, fileName, fileType);
                    };
                    reader.onerror = function() {
                        showNotification('Error: Could not read the file for download.', 3000);
                    };
                    reader.readAsDataURL(new Blob([data], { type: fileType }));
                } else {
                    showNotification("Download function is only available in the Android app.", 4000);
                }
            }

            // =================================================================
            // CURATED LIST OF WORKING TOOLS
            // =================================================================
            const tools = [
                { id: "age-calculator", title: "Age Calculator", desc: "Calculate exact age from a date of birth to the current date.", icon: "fa-calendar-alt" },
                { id: "emi-calculator", title: "EMI Calculator", desc: "Calculate your Equated Monthly Installment for loans.", icon: "fa-percent" },
                { id: "sip-calculator", title: "SIP Calculator", desc: "Estimate the returns on your Systematic Investment Plan (SIP).", icon: "fa-chart-line" },
                { id: "qr-code-generator", title: "QR Code Generator", desc: "Create and download QR codes for URLs, text, and more.", icon: "fa-qrcode" },
                { id: "password-generator", title: "Password Generator", desc: "Generate strong, secure, and customizable passwords.", icon: "fa-key" },
                { id: "word-counter", title: "Word Counter", desc: "Count words, characters, and sentences in your text.", icon: "fa-file-word" },
                { id: "base64-encoder", title: "Base64 Tools", desc: "Encode text to Base64 or decode from Base64 back to text.", icon: "fa-exchange-alt" },
                { id: "color-picker", title: "Color Picker", desc: "Pick a color and get its HEX, RGB, and HSL values.", icon: "fa-palette" },
                { id: "text-to-speech", title: "Text to Speech", desc: "Convert written text into speech using your device's voices.", icon: "fa-volume-up" },
                { id: "speech-to-text", title: "Speech to Text", desc: "Transcribe your spoken words into text using your microphone.", icon: "fa-microphone-alt" },
                { id: "json-formatter", title: "JSON Formatter", desc: "Validate, format, and beautify your JSON data for readability.", icon: "fa-code" },
                { id: "unit-converter", title: "Unit Converter", desc: "Convert between various units of length, weight, and temperature.", icon: "fa-ruler-combined" },
                { id: "bmi-calculator", title: "BMI Calculator", desc: "Calculate your Body Mass Index using metric or imperial units.", icon: "fa-weight" },
                { id: "timer-stopwatch", title: "Timer/Stopwatch", desc: "A versatile timer and stopwatch for all your timing needs.", icon: "fa-stopwatch" },
            ];

            // =================================================================
            // IMPLEMENTATIONS FOR THE WORKING TOOLS
            // All broken tool implementations have been removed.
            // =================================================================
            const toolImplementations = {
                'age-calculator': () => ({ content: `<input type="date" id="age-dob-input" class="tool-input"><button id="age-calc-btn" class="btn">Calculate Age</button><div id="age-result" class="result-box mt-1"></div>`, onMount: () => { document.getElementById('age-calc-btn').addEventListener('click', () => { const dobInput = document.getElementById('age-dob-input'); const resultBox = document.getElementById('age-result'); if (!dobInput.value) { resultBox.textContent = "Please select a date."; return; } const dob = new Date(dobInput.value); const today = new Date(); let age = today.getFullYear() - dob.getFullYear(); const m = today.getMonth() - dob.getMonth(); if (m < 0 || (m === 0 && today.getDate() < dob.getDate())) { age--; } resultBox.textContent = `You are ${age} years old.`; }); } }),
                'emi-calculator': () => ({ content: `<label for="emi-principal">Loan Amount ($):</label><input type="number" id="emi-principal" class="tool-input" placeholder="e.g., 100000"><label for="emi-rate">Annual Interest Rate (%):</label><input type="number" id="emi-rate" class="tool-input" placeholder="e.g., 7.5"><label for="emi-tenure">Loan Tenure (Years):</label><input type="number" id="emi-tenure" class="tool-input" placeholder="e.g., 10"><button id="emi-calc-btn" class="btn">Calculate EMI</button><div id="emi-result" class="result-box mt-1"></div>`, onMount: () => { document.getElementById('emi-calc-btn').addEventListener('click', () => { const P = parseFloat(document.getElementById('emi-principal').value); const annualRate = parseFloat(document.getElementById('emi-rate').value); const T = parseFloat(document.getElementById('emi-tenure').value); const resultBox = document.getElementById('emi-result'); if (isNaN(P) || isNaN(annualRate) || isNaN(T) || P <= 0 || annualRate <= 0 || T <= 0) { resultBox.textContent = "Please enter valid positive numbers in all fields."; return; } const R = (annualRate / 12) / 100; const N = T * 12; const EMI = (P * R * Math.pow(1 + R, N)) / (Math.pow(1 + R, N) - 1); if (isNaN(EMI)) { resultBox.textContent = "Could not calculate. Please check your inputs."; } else { resultBox.textContent = `Your monthly EMI is: $${EMI.toFixed(2)}`; } }); } }),
                'sip-calculator': () => ({ content: `<label for="sip-investment">Monthly Investment ($):</label><input type="number" id="sip-investment" class="tool-input" placeholder="e.g., 5000"><label for="sip-rate">Expected Annual Return Rate (%):</label><input type="number" id="sip-rate" class="tool-input" placeholder="e.g., 12"><label for="sip-tenure">Investment Period (Years):</label><input type="number" id="sip-tenure" class="tool-input" placeholder="e.g., 15"><button id="sip-calc-btn" class="btn">Calculate</button><div id="sip-result" class="result-box mt-1"></div>`, onMount: () => { document.getElementById('sip-calc-btn').addEventListener('click', () => { const P = parseFloat(document.getElementById('sip-investment').value); const annualRate = parseFloat(document.getElementById('sip-rate').value); const T = parseFloat(document.getElementById('sip-tenure').value); const resultBox = document.getElementById('sip-result'); if (isNaN(P) || isNaN(annualRate) || isNaN(T) || P <= 0 || annualRate <= 0 || T <= 0) { resultBox.textContent = "Please enter valid positive numbers."; return; } const n = T * 12; const i = (annualRate / 100) / 12; const M = P * ((Math.pow(1 + i, n) - 1) / i) * (1 + i); const totalInvested = P * n; const wealthGained = M - totalInvested; resultBox.innerHTML = `<p>Total Invested: $${totalInvested.toFixed(2)}</p><p>Wealth Gained: $${wealthGained.toFixed(2)}</p><p><strong>Estimated Future Value: $${M.toFixed(2)}</strong></p>`; }); } }),
                'bmi-calculator': () => ({ content: `<div class="tool-controls"><select id="bmi-units" class="tool-select"><option value="metric">Metric (kg, cm)</option><option value="imperial">Imperial (lbs, in)</option></select></div><div id="bmi-metric-inputs"><label for="bmi-weight-kg">Weight (kg):</label><input type="number" id="bmi-weight-kg" class="tool-input"><label for="bmi-height-cm">Height (cm):</label><input type="number" id="bmi-height-cm" class="tool-input"></div><div id="bmi-imperial-inputs" class="hidden"><label for="bmi-weight-lbs">Weight (lbs):</label><input type="number" id="bmi-weight-lbs" class="tool-input"><label for="bmi-height-in">Height (in):</label><input type="number" id="bmi-height-in" class="tool-input"></div><button id="bmi-calc-btn" class="btn">Calculate BMI</button><div id="bmi-result" class="result-box mt-1"></div>`, onMount: () => { const unitSelect = document.getElementById('bmi-units'); const metricInputs = document.getElementById('bmi-metric-inputs'); const imperialInputs = document.getElementById('bmi-imperial-inputs'); unitSelect.addEventListener('change', () => { metricInputs.classList.toggle('hidden', unitSelect.value === 'imperial'); imperialInputs.classList.toggle('hidden', unitSelect.value === 'metric'); }); document.getElementById('bmi-calc-btn').addEventListener('click', () => { let weight, height; const resultBox = document.getElementById('bmi-result'); if (unitSelect.value === 'metric') { weight = parseFloat(document.getElementById('bmi-weight-kg').value); height = parseFloat(document.getElementById('bmi-height-cm').value) / 100; } else { weight = parseFloat(document.getElementById('bmi-weight-lbs').value); height = parseFloat(document.getElementById('bmi-height-in').value); } if (isNaN(weight) || isNaN(height) || weight <= 0 || height <= 0) { resultBox.textContent = "Please enter valid weight and height."; return; } let bmi; if (unitSelect.value === 'metric') { bmi = weight / (height * height); } else { bmi = (weight / (height * height)) * 703; } let category = ''; if (bmi < 18.5) category = 'Underweight'; else if (bmi < 24.9) category = 'Normal weight'; else if (bmi < 29.9) category = 'Overweight'; else category = 'Obesity'; resultBox.innerHTML = `Your BMI is <strong>${bmi.toFixed(1)}</strong>. This is considered <strong>${category}</strong>.`; }); } }),
                'qr-code-generator': () => ({ content: `<input type="text" id="qr-text" class="tool-input" placeholder="https://example.com"><button id="qr-gen-btn" class="btn">Generate QR</button><div id="qr-output" class="text-center mt-1"></div>`, onMount: () => { const qrText = document.getElementById('qr-text'); const genBtn = document.getElementById('qr-gen-btn'); const output = document.getElementById('qr-output'); genBtn.addEventListener('click', () => { const text = qrText.value.trim(); if (!text) { showNotification("Please enter text or a URL for the QR code.", 3000); return; } const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=${encodeURIComponent(text)}`; output.innerHTML = ` <img src="${qrUrl}" alt="Generated QR Code" style="border:5px solid white; border-radius:var(--border-radius);"> <button class="btn mt-1" id="download-qr-code">Download SVG</button> `; document.getElementById('download-qr-code').addEventListener('click', () => { const svgUrl = `${qrUrl}&format=svg`; fetch(svgUrl).then(response => response.blob()).then(blob => { downloadFile(blob, 'qrcode.svg', 'image/svg+xml'); }).catch(e => showNotification("Failed to download QR code.", 3000)); }); }); } }),
                'password-generator': () => ({ content: ` <label for="pass-length">Password Length: <span id="pass-length-val">16</span></label> <input type="range" id="pass-length" min="8" max="32" value="16" class="tool-input"> <div class="tool-controls"> <label><input type="checkbox" id="pass-upper" checked> Uppercase</label> <label><input type="checkbox" id="pass-lower" checked> Lowercase</label> <label><input type="checkbox" id="pass-nums" checked> Numbers</label> <label><input type="checkbox" id="pass-syms" checked> Symbols</label> </div> <button id="pass-gen-btn" class="btn mt-1">Generate</button> <div id="pass-result" class="result-box mt-1" style="cursor:pointer;" title="Click to copy"></div> `, onMount: () => { const lengthSlider = document.getElementById('pass-length'); const lengthVal = document.getElementById('pass-length-val'); const resultBox = document.getElementById('pass-result'); const genBtn = document.getElementById('pass-gen-btn'); const options = { upper: document.getElementById('pass-upper'), lower: document.getElementById('pass-lower'), nums: document.getElementById('pass-nums'), syms: document.getElementById('pass-syms'), }; const chars = { upper: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ', lower: 'abcdefghijklmnopqrstuvwxyz', nums: '0123456789', syms: '!@#$%^&*()_+-=[]{}|;:,.<>?' }; lengthSlider.addEventListener('input', () => lengthVal.textContent = lengthSlider.value); genBtn.addEventListener('click', () => { const length = parseInt(lengthSlider.value); let charset = ''; if (options.upper.checked) charset += chars.upper; if (options.lower.checked) charset += chars.lower; if (options.nums.checked) charset += chars.nums; if (options.syms.checked) charset += chars.syms; if (charset === '') { resultBox.textContent = "Please select at least one character type."; return; } let password = ''; for (let i = 0; i < length; i++) { password += charset.charAt(Math.floor(Math.random() * charset.length)); } resultBox.textContent = password; showNotification("Password generated!", 2000); }); resultBox.addEventListener('click', () => { if (resultBox.textContent && resultBox.textContent.length > 1) { navigator.clipboard.writeText(resultBox.textContent).then(() => showNotification("Password copied to clipboard!", 2000)).catch(err => showNotification("Failed to copy password.", 2000)); } }); } }),
                'word-counter': () => ({ content: `<textarea id="wc-text" class="tool-textarea" placeholder="Start typing or paste your text here..."></textarea><div id="wc-result" class="result-box">Words: 0 | Characters: 0 | Sentences: 0</div>`, onMount: () => { const textarea = document.getElementById('wc-text'); const resultBox = document.getElementById('wc-result'); textarea.addEventListener('input', () => { const text = textarea.value; const words = text.trim() === '' ? 0 : text.trim().split(/\s+/).length; const chars = text.length; const sentences = (text.match(/[.!?]+/g) || []).length; resultBox.textContent = `Words: ${words} | Characters: ${chars} | Sentences: ${sentences}`; }); } }),
                'base64-encoder': () => ({ content: `<textarea id="b64-input" class="tool-textarea" placeholder="Enter text to encode or Base64 to decode..."></textarea><div class="tool-controls"><button id="b64-encode-btn" class="btn">Encode</button><button id="b64-decode-btn" class="btn btn-secondary">Decode</button></div><div id="b64-result" class="result-box mt-1"></div>`, onMount: () => { const input = document.getElementById('b64-input'); const resultBox = document.getElementById('b64-result'); document.getElementById('b64-encode-btn').addEventListener('click', () => { try { resultBox.textContent = btoa(input.value); showNotification("Text encoded to Base64!", 2000); } catch(e) { resultBox.textContent = "Error encoding text."; showNotification("Error: Could not encode text.", 3000); } }); document.getElementById('b64-decode-btn').addEventListener('click', () => { try { resultBox.textContent = atob(input.value); showNotification("Base64 decoded to text!", 2000); } catch(e) { resultBox.textContent = "Invalid Base64 string."; showNotification("Error: Invalid Base64 string.", 3000); } }); } }),
                'json-formatter': () => ({ content: `<textarea id="json-input" class="tool-textarea" placeholder="Paste your JSON here..."></textarea><button id="json-format-btn" class="btn">Format JSON</button><div id="json-result" class="result-box mt-1"><pre><code id="json-output"></code></pre></div>`, onMount: () => { const input = document.getElementById('json-input'); const outputCode = document.getElementById('json-output'); const resultBox = document.getElementById('json-result'); document.getElementById('json-format-btn').addEventListener('click', () => { try { const jsonObj = JSON.parse(input.value); outputCode.textContent = JSON.stringify(jsonObj, null, 4); resultBox.style.borderColor = 'var(--color-border)'; showNotification("JSON formatted successfully!", 2000); } catch (e) { outputCode.textContent = `Invalid JSON: ${e.message}`; resultBox.style.borderColor = 'red'; showNotification(`Invalid JSON: ${e.message}`, 4000); } }); } }),
                'color-picker': () => ({ content: ` <div class="text-center"> <input type="color" id="color-picker-input" value="#007bff" style="width:150px; height:150px; border:none; background:none; padding:0; border-radius: 50%; cursor: pointer;"> </div> <div id="color-values" class="result-box mt-1"></div> `, onMount: () => { const picker = document.getElementById('color-picker-input'); const valuesBox = document.getElementById('color-values'); function updateValues(hex) { const rgb = hexToRgb(hex); const hsl = rgbToHsl(rgb.r, rgb.g, rgb.b); valuesBox.innerHTML = ` <strong>HEX:</strong> ${hex}<br> <strong>RGB:</strong> rgb(${rgb.r}, ${rgb.g}, ${rgb.b})<br> <strong>HSL:</strong> hsl(${hsl.h}, ${hsl.s}%, ${hsl.l}%) `; } picker.addEventListener('input', () => updateValues(picker.value)); updateValues(picker.value); function hexToRgb(hex) { let r = 0, g = 0, b = 0; if (hex.length == 4) { r = "0x" + hex[1] + hex[1]; g = "0x" + hex[2] + hex[2]; b = "0x" + hex[3] + hex[3]; } else if (hex.length == 7) { r = "0x" + hex[1] + hex[2]; g = "0x" + hex[3] + hex[4]; b = "0x" + hex[5] + hex[6]; } return { r: +r, g: +g, b: +b }; } function rgbToHsl(r, g, b) { r /= 255; g /= 255; b /= 255; let max = Math.max(r, g, b), min = Math.min(r, g, b); let h, s, l = (max + min) / 2; if (max == min) { h = s = 0; } else { let d = max - min; s = l > 0.5 ? d / (2 - max - min) : d / (max + min); switch (max) { case r: h = (g - b) / d + (g < b ? 6 : 0); break; case g: h = (b - r) / d + 2; break; case b: h = (r - g) / d + 4; break; } h /= 6; } return { h: Math.round(h * 360), s: Math.round(s * 100), l: Math.round(l * 100) }; } } }),
                'text-to-speech': () => ({ content: `<textarea id="tts-text" class="tool-textarea" placeholder="Enter text to speak..."></textarea><label for="tts-voice">Voice:</label><select id="tts-voice" class="tool-select"></select><div class="tool-controls"><button id="tts-speak-btn" class="btn">Speak</button><button id="tts-stop-btn" class="btn btn-secondary">Stop</button></div>`, onMount: () => { const synth = window.speechSynthesis; if (!synth) { showNotification("Text-to-Speech is not supported in this browser/WebView.", 5000); return; } const textInput = document.getElementById('tts-text'); const voiceSelect = document.getElementById('tts-voice'); let voices = []; function populateVoiceList() { voices = synth.getVoices().sort((a, b) => a.name.localeCompare(b.name)); voiceSelect.innerHTML = voices.map((voice, i) => `<option value="${i}" ${voice.default ? 'selected' : ''}>${voice.name} (${voice.lang})</option>` ).join(''); if (voices.length === 0) { showNotification("No Text-to-Speech voices found. Please check device settings.", 5000); } } populateVoiceList(); if (synth.onvoiceschanged !== undefined) { synth.onvoiceschanged = populateVoiceList; } else { setTimeout(populateVoiceList, 500); } document.getElementById('tts-speak-btn').addEventListener('click', () => { if (synth.speaking) { showNotification("Already speaking. Please stop current speech first.", 3000); return; } if (textInput.value.trim() !== '') { const utterThis = new SpeechSynthesisUtterance(textInput.value); utterThis.voice = voices[voiceSelect.value]; if (!utterThis.voice && voices.length > 0) { utterThis.voice = voices.find(v => v.lang.startsWith('en')) || voices[0]; } synth.speak(utterThis); showNotification("Speaking...", 2000); } else { showNotification("Please enter text to speak.", 3000); } }); document.getElementById('tts-stop-btn').addEventListener('click', () => { synth.cancel(); showNotification("Speech stopped.", 2000); }); } }),
                'speech-to-text': () => ({ content: ` <div class="tool-controls"> <button id="stt-start-btn" class="btn">Start Listening</button> <button id="stt-stop-btn" class="btn btn-secondary hidden">Stop Listening</button> <button id="stt-download-btn" class="btn hidden" style="background-color:#28a745;">Download Transcript</button> </div> <div id="stt-result" class="result-box mt-1">Your transcribed text will appear here...</div> `, onMount: () => { const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition; if (!SpeechRecognition) { showNotification("Speech-to-Text is not supported in this browser/WebView.", 5000); return; } const recognition = new SpeechRecognition(); recognition.continuous = true; recognition.interimResults = true; recognition.lang = 'en-US'; const startBtn = document.getElementById('stt-start-btn'); const stopBtn = document.getElementById('stt-stop-btn'); const downloadBtn = document.getElementById('stt-download-btn'); const resultBox = document.getElementById('stt-result'); let final_transcript = ''; recognition.onstart = () => { startBtn.classList.add('hidden'); stopBtn.classList.remove('hidden'); downloadBtn.classList.add('hidden'); resultBox.textContent = 'Listening...'; showNotification("Listening for speech...", 3000); }; recognition.onresult = (event) => { let interim_transcript = ''; for (let i = event.resultIndex; i < event.results.length; ++i) { if (event.results[i].isFinal) { final_transcript += event.results[i][0].transcript + ' '; } else { interim_transcript += event.results[i][0].transcript; } } resultBox.innerHTML = final_transcript + `<span style="color:var(--color-text-secondary);">${interim_transcript}</span>`; }; recognition.onerror = (event) => { showNotification(`Speech recognition error: ${event.error}`, 5000); startBtn.classList.remove('hidden'); stopBtn.classList.add('hidden'); }; recognition.onend = () => { showNotification("Speech recognition stopped.", 3000); startBtn.classList.remove('hidden'); stopBtn.classList.add('hidden'); if (final_transcript.trim() !== '') { downloadBtn.classList.remove('hidden'); } }; startBtn.addEventListener('click', () => { final_transcript = ''; recognition.start(); }); stopBtn.addEventListener('click', () => { recognition.stop(); }); downloadBtn.addEventListener('click', () => { if (final_transcript.trim() !== '') { const textBlob = new Blob([final_transcript], { type: 'text/plain' }); downloadFile(textBlob, 'transcript.txt', 'text/plain'); } else { showNotification("No transcript to download.", 3000); } }); } }),
                'unit-converter': () => ({ content: ` <div class="tool-controls"> <input type="number" id="unit-input" class="tool-input" placeholder="Enter value"> <select id="unit-from" class="tool-select"></select> <span>to</span> <select id="unit-to" class="tool-select"></select> </div> <select id="unit-category" class="tool-select mt-1"> <option value="length">Length</option> <option value="weight">Weight</option> <option value="temperature">Temperature</option> </select> <div id="unit-result" class="result-box mt-1"></div> `, onMount: () => { const units = { length: { meter: 1, kilometer: 1000, centimeter: 0.01, mile: 1609.34, foot: 0.3048, inch: 0.0254 }, weight: { gram: 1, kilogram: 1000, pound: 453.592, ounce: 28.3495 }, temperature: {} }; const categorySelect = document.getElementById('unit-category'); const fromSelect = document.getElementById('unit-from'); const toSelect = document.getElementById('unit-to'); const input = document.getElementById('unit-input'); const resultBox = document.getElementById('unit-result'); function populateUnits() { const category = categorySelect.value; let options = ''; if (category === 'temperature') { options = `<option value="celsius">Celsius</option><option value="fahrenheit">Fahrenheit</option><option value="kelvin">Kelvin</option>`; } else { options = Object.keys(units[category]).map(u => `<option value="${u}">${u.charAt(0).toUpperCase() + u.slice(1)}</option>`).join(''); } fromSelect.innerHTML = options; toSelect.innerHTML = options; convert(); } function convert() { const val = parseFloat(input.value); if (isNaN(val)) { resultBox.textContent = ''; return; } const category = categorySelect.value; const fromUnit = fromSelect.value; const toUnit = toSelect.value; let result; if (category === 'temperature') { let valCelsius; if (fromUnit === 'celsius') valCelsius = val; else if (fromUnit === 'fahrenheit') valCelsius = (val - 32) * 5/9; else if (fromUnit === 'kelvin') valCelsius = val - 273.15; if (toUnit === 'celsius') result = valCelsius; else if (toUnit === 'fahrenheit') result = (valCelsius * 9/5) + 32; else if (toUnit === 'kelvin') result = valCelsius + 273.15; } else { const baseValue = val * units[category][fromUnit]; result = baseValue / units[category][toUnit]; } resultBox.textContent = `${val} ${fromUnit.replace(/(\w)(\w*)/g, (g0,g1,g2) => g1.toUpperCase() + g2)} = ${result.toFixed(4)} ${toUnit.replace(/(\w)(\w*)/g, (g0,g1,g2) => g1.toUpperCase() + g2)}`; } categorySelect.addEventListener('change', populateUnits); input.addEventListener('input', convert); fromSelect.addEventListener('change', convert); toSelect.addEventListener('change', convert); populateUnits(); } }),
                'timer-stopwatch': () => ({ content: ` <div class="tool-controls"> <button id="ts-mode-stopwatch" class="btn">Stopwatch</button> <button id="ts-mode-timer" class="btn btn-secondary">Timer</button> </div> <div id="ts-timer-inputs" class="hidden mt-1 tool-controls"> <input type="number" id="ts-hours" class="tool-input" min="0" placeholder="H"> <input type="number" id="ts-minutes" class="tool-input" min="0" max="59" placeholder="M"> <input type="number" id="ts-seconds" class="tool-input" min="0" max="59" placeholder="S"> </div> <div id="ts-display" class="result-box mt-1" style="font-size: 2.5rem; text-align: center; font-family: 'Courier New', monospace;">00:00:00.000</div> <div class="tool-controls mt-1"> <button id="ts-start-btn" class="btn">Start</button> <button id="ts-stop-btn" class="btn btn-secondary">Stop</button> <button id="ts-reset-btn" class="btn">Reset</button> </div> `, onMount: () => { let mode = 'stopwatch', interval, startTime, elapsedTime = 0, timerDuration = 0; const display = document.getElementById('ts-display'); const timerInputs = document.getElementById('ts-timer-inputs'); const h_in = document.getElementById('ts-hours'); const m_in = document.getElementById('ts-minutes'); const s_in = document.getElementById('ts-seconds'); function formatTime(ms) { const totalSeconds = Math.floor(ms / 1000); const hours = Math.floor(totalSeconds / 3600); const minutes = Math.floor((totalSeconds % 3600) / 60); const seconds = totalSeconds % 60; const milliseconds = Math.floor(ms % 1000); const pad = (num, size = 2) => num.toString().padStart(size, '0'); if (hours > 0) { return `${pad(hours)}:${pad(minutes)}:${pad(seconds)}`; } return `${pad(minutes)}:${pad(seconds)}.${pad(milliseconds, 3)}`; } function updateDisplay() { if (mode === 'stopwatch') { const now = Date.now(); elapsedTime = now - startTime; display.textContent = formatTime(elapsedTime); } else { const remaining = timerDuration - (Date.now() - startTime); if (remaining <= 0) { clearInterval(interval); interval = null; display.textContent = '00:00:00.000'; showNotification("Timer finished!", 3000); return; } display.textContent = formatTime(remaining); } } document.getElementById('ts-mode-stopwatch').addEventListener('click', () => { mode = 'stopwatch'; timerInputs.classList.add('hidden'); reset(); }); document.getElementById('ts-mode-timer').addEventListener('click', () => { mode = 'timer'; timerInputs.classList.remove('hidden'); reset(); }); document.getElementById('ts-start-btn').addEventListener('click', () => { if (interval) return; if (mode === 'timer') { const h = parseInt(h_in.value) || 0; const m = parseInt(m_in.value) || 0; const s = parseInt(s_in.value) || 0; timerDuration = (h * 3600 + m * 60 + s) * 1000; if (timerDuration <= 0) { showNotification("Please set a timer duration.", 3000); return; } startTime = Date.now(); } else { startTime = Date.now() - elapsedTime; } interval = setInterval(updateDisplay, 10); showNotification("Started!", 2000); }); document.getElementById('ts-stop-btn').addEventListener('click', () => { clearInterval(interval); interval = null; showNotification("Stopped.", 2000); }); function reset() { clearInterval(interval); interval = null; elapsedTime = 0; timerDuration = 0; if (mode === 'stopwatch') { display.textContent = '00:00:00.000'; } else { display.textContent = '00:00:00.000'; h_in.value = ''; m_in.value = ''; s_in.value = ''; } showNotification("Reset.", 2000); } document.getElementById('ts-reset-btn').addEventListener('click', reset); } })
            };

            // --- UNIVERSAL SETUP FUNCTIONS (UNCHANGED) ---
            function renderToolCards() { toolsGrid.innerHTML = tools.map(tool => ` <article class="tool-card" data-tool-id="${tool.id}"> <i class="fas ${tool.icon} card-icon"></i> <h2>${tool.title}</h2> </article> `).join(''); }
            let notificationTimeout; function showNotification(message, duration = 3000) { clearTimeout(notificationTimeout); notificationEl.textContent = message; notificationEl.style.opacity = '1'; notificationEl.style.bottom = '20px'; notificationTimeout = setTimeout(() => { notificationEl.style.opacity = '0'; notificationEl.style.bottom = '-100px'; }, duration); }
            function openModal(toolId) { const toolData = tools.find(t => t.id === toolId); const tool = toolImplementations[toolId]; if (!toolData || !tool) return; const { content, onMount } = tool(); modalContent.innerHTML = ` <div class="modal-header"> <h2>${toolData.title}</h2> <button id="modal-close-btn" class="modal-close-btn">×</button> </div> <p class="modal-description">${toolData.desc}</p> <div class="tool-section"> ${content} </div> `; modalContainer.classList.add('show'); document.body.style.overflow = 'hidden'; document.getElementById('modal-close-btn').addEventListener('click', closeModal); if (onMount) { onMount(); } }
            function closeModal() { modalContainer.classList.remove('show'); document.body.style.overflow = 'auto'; modalContent.innerHTML = ''; }
            toolsGrid.addEventListener('click', (e) => { const card = e.target.closest('.tool-card'); if (card) { const toolId = card.dataset.toolId; openModal(toolId); } });
            modalContainer.addEventListener('click', (e) => { if (e.target === modalContainer) { closeModal(); } });
            document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && modalContainer.classList.contains('show')) { closeModal(); } });

            // --- INITIALIZE THE APP ---
            renderToolCards();
        });
    </script>
</body>
</html>
